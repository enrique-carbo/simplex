---
import Layout from '@/layouts/PageLayout.astro';
import Hero from '@/components/widgets/Hero.astro';
import ProductList from '@/components/ecommerce/ProductList';
---

<Layout metadata={{ title: 'Remeras' }}>
  <!-- Hero Widget ******************* -->
  <Hero tagline="Simplex Remeras">
    <Fragment slot="title">
      Remeras
    </Fragment>
    <Fragment slot="subtitle">
      Nuestras remeras en tus dispositivos.
    </Fragment>
  </Hero>

  <!---------- Product List --------------------------->

  <div class="intersect-once motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade">
    <!-- ProductList ahora maneja su propia data desde Nanostores
      - client:only="react" asegura que se ejecute solo en cliente
      - category="remeras" filtra desde el store global
      - showCategoryTitle={true} muestra el tÃ­tulo de categorÃ­a
    -->
    <ProductList client:load category="remeras"/>
  </div>

</Layout>

<!-- Script de diagnÃ³stico (opcional, para debug) -->
  <script>
    console.log('ðŸª PÃ¡gina /remeras cargada');

    // â­â­ FALLBACK TAMBIÃ‰N AQUÃ â­â­
    const PB_URL = import.meta.env.PUBLIC_POCKETBASE_URL || 'https://pb.simplex.ar';
    console.log('ðŸ”— PocketBase URL (con fallback):', PB_URL);
    console.log('ðŸ”— import.meta.env.PUBLIC_POCKETBASE_URL:', import.meta.env.PUBLIC_POCKETBASE_URL);
    console.log('ðŸ“± Entorno:', import.meta.env.MODE);

    // Verificar si hay cache de productos en localStorage
    const cached = localStorage.getItem('simplex_products_cache_v1');
    if (cached) {
      try {
        const parsed = JSON.parse(cached);
        console.log(`ðŸ“¦ Cache encontrado: ${parsed.data?.length || 0} productos`);
        console.log(`ðŸ• Cache fecha: ${new Date(parsed.timestamp).toLocaleString()}`);
      } catch(e) {
        console.log('ðŸ“¦ Cache invÃ¡lido');
      }
    }

    // Test directo a la API
    fetch(`${PB_URL}/api/collections/products/records?filter=category="remeras"`)
    .then(r => {
      console.log('Test API - Status:', r.status, 'OK:', r.ok);
      return r.json();
    })
    .then(data => {
      console.log('Test API - Productos:', data.items?.length || 0);
    })
    .catch(e => console.error('Test API - Error:', e));
    
  </script>